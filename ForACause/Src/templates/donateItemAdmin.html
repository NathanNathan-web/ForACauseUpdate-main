{% extends "base.html" %}
{% block title %}ForACause - Donation Management{% endblock %}

{% block content %}
<div class="container">
    <div class="table-responsive">
        <table class="table table-hover">
            <thead class="table-light-blue">
                <tr>
                    <th scope="col" class="topleft">ID</th>
                    <th scope="col" >Item Image</th>                   
                    <th scope="col">User ID</th>
                    <th scope="col">Item Name</th>
                    <th scope="col">Description</th>
                    <th scope="col">Category</th>
                    <th scope="col">Quantity</th>
                    <th scope="col">Condition</th>
                    <th scope="col">Drop-off Method</th>
                    <th scope="col">Address</th>
                    <th scope="col">Preferred Date</th>
                    <th scope="col">Preferred Time</th>
                    <th scope="col">Organisation</th>
                    <th scope="col">Status</th>
                    <th scope="col" class="topright" colspan="2">Action</th>
                </tr>
            </thead>

            <tbody>
                {% for item in donation_items %}
                <tr>
                    <td>{{ item.id }}</td>
                    <td>
                        {% if item.image_file %}
                        <img src="{{ url_for('static', filename='images/' + item.image_file) }}" alt="Item Image" style="height:5vh; width: 3vw;">
                        {% else %}
                        <span>No Image</span>
                        {% endif %}
                    </td>
                    <td>{{ item.user_id }}</td>
                    <td>{{ item.name }}</td>
                    <td>{{ item.description }}</td>
                    <td>{{ item.category }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>{{ item.condition }}</td>
                    <td>{{ item.preferred_drop_off_method }}</td>
                    <td>{{ item.address or "N/A" }}</td>
                    <td>{{ item.preferred_date or "N/A" }}</td>
                    <td>{{ item.preferred_time or "N/A" }}</td>
                    <td>{{ item.organisation }}</td>
                    <td>
                        {% if item.preferred_drop_off_method == "drop_off" %}
                            {% if item.status == "Pending" %}
                            <a href="{{ url_for('update_status', id=item.id, new_status='Completed') }}">
                                <button class="pending">Pending</button>
                            </a>
                            {% elif item.status == "Completed" %}
                            <a href="{{ url_for('update_status', id=item.id, new_status='Pending') }}">
                                <button class="completed">Completed</button>
                            </a>
                            {% endif %}
                        {% elif item.preferred_drop_off_method == "pickup" %}
                            {% if item.status == "Pending" %}
                            <a href="{{ url_for('update_status', id=item.id, new_status='Out for Collection') }}">
                                <button class="pending">Pending</button>
                            </a>
                            {% elif item.status == "Out for Collection" %}
                            <a href="{{ url_for('update_status', id=item.id, new_status='Completed') }}">
                                <button class="out-for-collection">Out for Collection</button>
                            </a>
                            {% elif item.status == "Completed" %}
                            <a href="{{ url_for('update_status', id=item.id, new_status='Pending') }}">
                                <button class="completed">Completed</button>
                            </a>
                            {% endif %}
                        {% endif %}
                    </td>                                        
                    <td><a href="/edit_donation_item/{{ item.id }}" class="btn btn-warning"><i class="bi bi-pencil-square"></i></a></td>
                    <td>
                        <form action="{{ url_for('deletedonationitem', id=item.id) }}" method="POST">
                            <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#myModal_{{ item.id }}"><i class="bi bi-trash"></i></button>
                            <div class="modal" id="myModal_{{ item.id }}">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h4 class="modal-title">Delete Confirmation</h4>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                        </div>
                                        <div class="modal-body">Are you sure you want to delete "{{ item.name }}"?</div>
                                        <div class="modal-footer">
                                            <input type="submit" value="Delete" class="btn btn-danger">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot class="table-light-blue">
                <tr>
                    <th class="bottomleft"></th>
                    <th colspan="13"></th>
                    <th class="bottomright"></th>
                </tr>
            </tfoot>
        </table>
    </div>
</div>
{% endblock %}
